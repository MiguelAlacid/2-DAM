package ctrl;

import java.awt.Color;
import java.awt.TextField;
import java.io.File;
import java.io.*;
import java.util.*;

import javax.swing.DefaultListModel;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.filechooser.FileNameExtensionFilter;
import javax.swing.text.AttributeSet.ColorAttribute;

import model.Persona;

public class CtrlPrincipal {

	public static ArrayList <Persona> aPersonas;
	
	public static void inicio() {

		new view.frmPrincipal();

	}

	public static ArrayList<Persona> leerFichero(File fch) {
		ArrayList<Persona> contenido = new ArrayList<Persona>();

		try {
			FileReader fichero = new FileReader(fch);
			BufferedReader bufLectura = new BufferedReader(fichero);

			String lineaLeida;
			lineaLeida = bufLectura.readLine();
			while (lineaLeida != null) {
				// A CONTINUACION PROCESO LA LINEA LEIDA..
				StringTokenizer sToken = new StringTokenizer(lineaLeida, "#");
				String sNombre = sToken.nextToken();
				String sTelefono = sToken.nextToken();
				
				
				contenido.add(new Persona(sNombre, sTelefono));

				lineaLeida = bufLectura.readLine();
			}

			bufLectura.close();
			fichero.close();
		} catch (FileNotFoundException e) {
			System.out.println("El fichero " + fch + " no existe");
		} catch (IOException e) {
			System.out.println("El fichero " + fch + " no existe");
		}
		return contenido;
	}

	public static void abrirFichero() {
		JFileChooser selectorFch = new JFileChooser();

		selectorFch.setFileSelectionMode(JFileChooser.FILES_ONLY);

		FileNameExtensionFilter imgFilter = new FileNameExtensionFilter("Formato texto", "txt");
		selectorFch.setFileFilter(imgFilter);
		int iBtnFch = selectorFch.showOpenDialog(null);
		if (iBtnFch != JFileChooser.CANCEL_OPTION) {
			File fileName = selectorFch.getSelectedFile();
			if (fileName != null && !fileName.getName().equals("")) {
				aPersonas = leerFichero(fileName);
				volcarContactos(aPersonas);
				

			}
		}
	}
	
	public static void volcarContactos(ArrayList<Persona> aPersonas) {
		String sNombre ="";
		DefaultListModel modelo = new DefaultListModel();
		for(int iContador = 0; iContador < aPersonas.size(); iContador++) {
			sNombre = aPersonas.get(iContador).getsNombre();
			modelo.addElement(sNombre);
		}
		view.frmPrincipal.lstNombres.setModel(modelo);
	}

	public static void guardarFichero() {
		JFileChooser selectorFch = new JFileChooser();

		selectorFch.setFileSelectionMode(JFileChooser.FILES_ONLY);

		FileNameExtensionFilter imgFilter = new FileNameExtensionFilter("Formato de imágenes", "jpg", "bmp", "gif");
		selectorFch.setFileFilter(imgFilter);
		int iBtnFch = selectorFch.showSaveDialog(null);
		if (iBtnFch != JFileChooser.CANCEL_OPTION) {
			File fileName = selectorFch.getSelectedFile();
			if (fileName != null && !fileName.getName().equals("")) {
				System.out.println(fileName.getAbsolutePath());
			}
		}
	}
}
